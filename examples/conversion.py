from __future__ import print_function

# I can't believe they moved reduce from the global space :(
from functools import reduce

from xeddsa.implementations import XEdDSA25519

def bytesToString(bytes):
    return reduce(lambda x, y: x + y, [ chr(x) for x in bytes ])

def toBytes(data):
    return [ ord(x) for x in data ]

montgomery_private_keys = [
    [  64,  81, 123, 142, 221, 174,  16,  38, 255, 223,  32,  95, 158, 218,  21, 218, 204,  14, 249, 236, 175,  89, 128, 135,   8, 249,  66,  45,  48, 180,  87,  76 ],
    [  56, 177, 193,  66,  67, 151, 206,  89, 145,  55,  11,  49,  82, 238, 237,  21,  90,  69,   0,  81,  51, 181, 177,  45, 110, 232,  47,  23,  47,  95, 111,  97 ],
    [  16,  89, 188, 167, 166, 159,  66, 187, 160,  40,  35,  68, 147,  79,   8,  23, 151, 173,  32, 178,  64,  77,  49,  36, 216, 229,  81,  46, 107,  52, 151, 126 ],
    [ 192,  31,  70,   6, 221,  86, 116, 122,  63, 137,  25, 229, 107, 115,  15,  60, 154, 203,  26, 132, 103, 204, 122,  54, 204,  92,  90,  14, 116, 115,  37,  88 ],
    [ 136,  51, 205, 183,  26,   3,  11,  73, 129,   5, 225, 239, 197,  61,  82,   3,  27,   1, 208,  87, 125, 254,  57, 204,  60,   3,  69,  76, 102, 251, 202,  76 ],
    [  56,  73,  69,  21, 188, 211, 128, 177, 106, 249, 176,  89,  87, 123, 219,  97, 132,  49,   1, 225,   2, 234,  94, 198, 241, 250,  66, 245, 114, 113, 250,  81 ],
    [ 104,  49,   2, 128,  37, 129,  99, 215,  17, 243, 114, 237, 106, 158,  47, 105,  96,  39,  35, 180, 227, 115, 135,  82,  93, 196, 234, 142,   5, 170, 191,  90 ],
    [  32, 127, 124, 149, 221, 210,  97, 169, 131, 132, 247, 234, 167, 208,  94, 236, 149,  27,  11,  62, 248, 120, 142, 111,  47, 107,  74, 133, 238,  24, 193, 106 ],
    [ 144, 161,  20,  74,  35,  51, 178,   8,   3,   2, 219,  54, 230, 249, 220,  25, 211,  15,  79, 150, 153, 204,  35, 240, 228, 198,  54,  33, 142, 230,  52,  72 ],
    [ 160,  13, 213, 129,  63,  20,  71,  67,  23,   3,  91, 163, 156, 187, 219, 254, 129,  60, 121,  37,  83, 242, 209,  91,  81, 208, 130, 135,  92, 192,   8,  84 ]
]

montgomery_public_keys = map(XEdDSA25519._restoreEncryptionKey, montgomery_private_keys)

twisted_edwards_private_keys = [
    [  64,  81, 123, 142, 221, 174,  16,  38, 255, 223,  32,  95, 158, 218,  21, 218, 204,  14, 249, 236, 175,  89, 128, 135,   8, 249,  66,  45,  48, 180,  87,  76 ],
    [  56, 177, 193,  66,  67, 151, 206,  89, 145,  55,  11,  49,  82, 238, 237,  21,  90,  69,   0,  81,  51, 181, 177,  45, 110, 232,  47,  23,  47,  95, 111,  97 ],
    [  88,  70, 242,  63,  44, 121,  80,   5,  18, 190, 153, 211,  97, 127, 239, 143, 105,  82, 223,  77, 191, 178, 206, 219,  39,  26, 174, 209, 148, 203, 104,   1 ],
    [ 206, 215, 124,  39, 193, 251, 249, 149, 198,  35, 180, 236, 203, 103,  42,  65, 102,  52, 229, 123, 152,  51, 133, 201,  51, 163, 165, 241, 139, 140, 218,   7 ],
    [ 136,  51, 205, 183,  26,   3,  11,  73, 129,   5, 225, 239, 197,  61,  82,   3,  27,   1, 208,  87, 125, 254,  57, 204,  60,   3,  69,  76, 102, 251, 202,  76 ],
    [  86, 174, 125,  24, 226, 126, 237,  94, 155, 179,  28, 120, 224,  95,  94,  27, 124, 206, 254,  30, 253,  21, 161,  57,  14,   5, 189,  10, 141, 142,   5,  14 ],
    [  38, 198, 192, 173, 120, 209,  10,  57, 244, 185,  90, 228, 204,  60,  10,  20, 160, 216, 220,  75,  28, 140, 120, 173, 162,  59,  21, 113, 250,  85,  64,   5 ],
    [  91,  76,  60, 245, 218, 226,  30, 191,  88, 197, 205, 137, 110,   4, 186, 165, 106, 228, 244, 193,   7, 135, 113, 144, 208, 148, 181, 122,  17, 231,  62,   5 ],
    [ 144, 161,  20,  74,  35,  51, 178,   8,   3,   2, 219,  54, 230, 249, 220,  25, 211,  15,  79, 150, 153, 204,  35, 240, 228, 198,  54,  33, 142, 230,  52,  72 ],
    [ 238, 233, 237, 171,  94,  62,  39, 205, 238, 169, 114,  46, 155,  31,  94, 126, 126, 195, 134, 218, 172,  13,  46, 164, 174,  47, 125, 120, 163,  63, 247,  11 ]
]

twisted_edwards_public_keys = [
    [  25, 155, 161,  48,  30, 181, 137,  77, 140, 124,   2, 160, 183, 226,  33, 159, 234, 141,  50, 112, 208,  76,  33, 246, 149,   9, 158, 115, 148, 167,  84,  56 ],
    [  95, 173, 254,  20, 237, 252,  63,  13, 213, 199, 162,  34, 178, 253, 103,  70,  50, 241, 211, 175, 153,  77, 254, 169, 114,  16, 164, 230,  70,  10,  55,  63 ],
    [ 123, 120,  42, 109, 167, 116,  82,  77, 133,  84, 201, 184,  44, 254,  41,  85, 213, 132,  78,  36,  79, 216, 205, 220,  41, 236, 208,  38, 211,  97, 247,  41 ],
    [  85, 130, 245,  79, 248,  28, 176,  86, 197, 240, 193, 238,  66, 142, 146, 141, 161, 110,  84, 250, 137,  22, 208,  72,  15, 152, 210,  80,  66,  50, 143,  48 ],
    [ 238, 166,  26, 242, 167, 217, 129, 137, 226, 221,  22, 117,  29,  50, 197, 198,  21, 119, 177,  87,  57, 199, 231,  51,  45, 186, 104,  25,  43, 166,  63,   6 ],
    [ 232,  61, 237,  74,  89, 132,  69, 183,   6, 201, 140, 120, 200, 230, 205,   8, 158, 225, 165,  14, 103, 251, 236,  98, 190,   1, 158,   0, 235, 126, 140,  53 ],
    [ 128, 199, 239,   7,  29, 193,  39, 133,  51,  40, 160,  33, 241, 178,  41, 148,  24, 170, 123,  33, 184,  54, 135,  71, 191, 232,  35, 174,  16,  43,  10,  18 ],
    [ 165, 127, 134, 190, 187, 212,  90,  80, 160, 122, 161,  60, 135,  22,   5, 156, 199,  49, 253, 154,  59, 116, 104, 110, 184,  76,  14, 206,   6,  39,   0, 108 ],
    [ 165, 209, 207, 192, 170, 182, 143, 226, 103, 249, 187, 119, 195, 103,  12,  37,  26, 187, 203, 102, 106, 237, 238, 114, 146, 228, 229,  67,  23,  24, 147,  79 ],
    [  24,  72,  19,  97, 189,  66, 132, 228, 127, 117, 241, 233, 157, 137, 253,  46,  79, 232, 252, 224, 151,  13, 203,  36, 173, 182, 190, 179, 225, 203, 253,  77 ]
]

if __name__ == "__main__":
    tests = 0
    successes = 0
    
    for mont_priv, mont_pub, wanted_ed_priv, wanted_ed_pub in zip(montgomery_private_keys, montgomery_public_keys, twisted_edwards_private_keys, twisted_edwards_public_keys):
        success = True

        calculated_ed_pub, calculated_ed_priv = XEdDSA25519._mont_priv_to_ed_pair(mont_priv)

        if calculated_ed_priv != wanted_ed_priv:
            success = False
            print("")
            print("Unequal twisted Edwards private keys for Montgomery private key:", mont_priv)
            print("Expected:", wanted_ed_priv)
            print("Got:", calculated_ed_priv)

        if calculated_ed_pub != wanted_ed_pub:
            success = False
            print("")
            print("Unequal twisted Edwards public keys for Montgomery private key:", mont_priv)
            print("Expected:", wanted_ed_pub)
            print("Got:", calculated_ed_pub)

        calculated_ed_pub = XEdDSA25519._mont_pub_to_ed_pub(mont_pub)

        if calculated_ed_pub != wanted_ed_pub:
            success = False
            print("")
            print("Unequal twisted Edwards public keys for Montgomery public key:", mont_pub)
            print("Expected:", wanted_ed_pub)
            print("Got:", calculated_ed_pub)

        if success:
            print("Test #" + str(tests + 1) + " successful!")
            successes += 1
        else:
            print("Test #" + str(tests + 1) + " failed.")

        tests += 1

    print("All tests done, " + str(successes) + "/" + str(tests) + " successful.")
